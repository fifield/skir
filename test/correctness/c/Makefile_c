
#
#ifndef STREAM_SIZE
#  STREAM_SIZE=16384
#endif

ifdef CORRECTNESS
  SKIR_DEFS=-DCORRECTNESS=${CORRECTNESS}
#  DEFS=-DCORRECTNESS=${CORRECTNESS} -DSTREAM_SIZE=${STREAM_SIZE}
else
  SKIR_DEFS=
#  DEFS=-DSTREAM_SIZE=${STREAM_SIZE}
endif

ifndef SKIR_OPT_LVL
  SKIR_OPT_LVL=2
endif

ifndef SKIR_OUT
  SKIR_OUT=./output
endif
o=${SKIR_OUT}

include ../../Makefile.SKIR

#
# building
#

EXES = $(patsubst %.cpp,%-opt.bc,$(wildcard *.cpp))
LLVM_BCS = $(patsubst %.cpp,%.bc,$(wildcard *.cpp))
#STATS = $(patsubst %.cpp,$(o)/%.stats,$(wildcard *.cpp))
#DOTS = $(patsubst %.cpp,$(o)/%.dot,$(wildcard *.cpp))
LOGS = $(patsubst %.cpp,%-skir.log,$(wildcard *.cpp))
RUNS = $(patsubst %.cpp,%-skir.run,$(wildcard *.cpp))
#OBJS = $(patsubst %.cpp,%.o,$(wildcard *.cpp))

.SECONDARY: ${LOGS} ${RUNS} ${LLVM_BCS}

exe: ${EXES}

test: ${LOGS}

# LLVM_BCS
%.bc: %.cpp
	llvm-g++ ${CXX_FLAGS} ${DEFS} -emit-llvm -c -o $@ $<

# clean
clean:
	rm -f *.bc *.log *.run *.ll *.dot
